import{s as Y,n as S,d as he,k as _e,r as me}from"../chunks/scheduler.UsNOiup1.js";import{S as fe,i as de,e as E,t as V,s as I,c as T,a as D,b as q,d as g,f as O,p as y,F as J,g as M,h as w,j as F,m as j,l as B,z as Q,k as P,y as W,o as pe,n as H,w as Z,u as L,q as G,r as $,A as ve,B as ge,C as ke,D as be}from"../chunks/index.3yGfJt-g.js";import{h as x,u as Ce}from"../chunks/await_block.yqX-BUaY.js";import{e as R}from"../chunks/each.6w4Ej4nR.js";import{j as ee,d as te,a as K,c as X,T as we,b as Ee,i as le}from"../chunks/firebase.224fbcjl.js";import{u as Te}from"../chunks/store.MIH45tLv.js";function Ue(s){var _,m;let e,l,t=((m=(_=s[1])==null?void 0:_.data)==null?void 0:m.username)+"",a,o,n,r,i=s[0].data.content+"",f,d,u,h;return{c(){e=E("p"),l=E("a"),a=V(t),n=I(),r=E("span"),f=V(i),d=I(),u=E("span"),h=V(s[3]),this.h()},l(p){e=T(p,"P",{class:!0});var c=D(e);l=T(c,"A",{class:!0,href:!0});var C=D(l);a=q(C,t),C.forEach(g),n=O(c),r=T(c,"SPAN",{class:!0});var k=D(r);f=q(k,i),k.forEach(g),d=O(c),u=T(c,"SPAN",{class:!0});var b=D(u);h=q(b,s[3]),b.forEach(g),c.forEach(g),this.h()},h(){var p,c;y(l,"class","toned-down"),y(l,"href",o="/users/"+((p=s[1])==null?void 0:p.uid)),y(r,"class","message svelte-1g9awsy"),y(u,"class","toned-down"),y(e,"class","svelte-1g9awsy"),J(e,"own",s[2]===((c=s[1])==null?void 0:c.uid))},m(p,c){M(p,e,c),w(e,l),w(l,a),w(e,n),w(e,r),w(r,f),w(e,d),w(e,u),w(u,h)},p(p,[c]){var C,k,b,N;c&2&&t!==(t=((k=(C=p[1])==null?void 0:C.data)==null?void 0:k.username)+"")&&F(a,t),c&2&&o!==(o="/users/"+((b=p[1])==null?void 0:b.uid))&&y(l,"href",o),c&1&&i!==(i=p[0].data.content+"")&&F(f,i),c&8&&F(h,p[3]),c&6&&J(e,"own",p[2]===((N=p[1])==null?void 0:N.uid))},i:S,o:S,d(p){p&&g(e)}}}function ye(s,e,l){let t,{message:a}=e,{user:o}=e,{currentUid:n}=e;return s.$$set=r=>{"message"in r&&l(0,a=r.message),"user"in r&&l(1,o=r.user),"currentUid"in r&&l(2,n=r.currentUid)},s.$$.update=()=>{s.$$.dirty&1&&l(3,t=new Date(a.data.time.seconds*1e3).toTimeString())},[a,o,n,t]}class Ne extends fe{constructor(e){super(),de(this,e,ye,Ue,Y,{message:0,user:1,currentUid:2})}}function ae(s,e,l){const t=s.slice();return t[16]=e[l],t}function se(s,e,l){const t=s.slice();return t[19]=e[l],t}function ne(s,e,l){const t=s.slice();return t[23]=e[l],t}function Me(s){return{c:S,l:S,m:S,p:S,d:S}}function De(s){let e,l=R(s[22]),t=[];for(let a=0;a<l.length;a+=1)t[a]=oe(ne(s,l,a));return{c(){for(let a=0;a<t.length;a+=1)t[a].c();e=H()},l(a){for(let o=0;o<t.length;o+=1)t[o].l(a);e=H()},m(a,o){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(a,o);M(a,e,o)},p(a,o){if(o&323){l=R(a[22]);let n;for(n=0;n<l.length;n+=1){const r=ne(a,l,n);t[n]?t[n].p(r,o):(t[n]=oe(r),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=l.length}},d(a){a&&g(e),Z(t,a)}}}function oe(s){let e,l=s[23].data.name+"",t,a,o,n;function r(){return s[10](s[23])}return{c(){e=E("button"),t=V(l),a=I(),this.h()},l(i){e=T(i,"BUTTON",{});var f=D(e);t=q(f,l),a=O(f),f.forEach(g),this.h()},h(){var i;J(e,"hollow",s[23].uid===((i=s[1])==null?void 0:i.uid))},m(i,f){M(i,e,f),w(e,t),w(e,a),o||(n=L(e,"click",r),o=!0)},p(i,f){var d;s=i,f&1&&l!==(l=s[23].data.name+"")&&F(t,l),f&67&&J(e,"hollow",s[23].uid===((d=s[1])==null?void 0:d.uid))},d(i){i&&g(e),o=!1,n()}}}function Se(s){let e,l="Hämtar chattar...";return{c(){e=E("p"),e.textContent=l},l(t){e=T(t,"P",{"data-svelte-h":!0}),j(e)!=="svelte-17go10z"&&(e.textContent=l)},m(t,a){M(t,e,a)},p:S,d(t){t&&g(e)}}}function Ie(s){let e,l="Skapa ny chatt",t,a;return{c(){e=E("button"),e.textContent=l},l(o){e=T(o,"BUTTON",{"data-svelte-h":!0}),j(e)!=="svelte-1jmfc8q"&&(e.textContent=l)},m(o,n){M(o,e,n),t||(a=L(e,"click",s[12]),t=!0)},p:S,d(o){o&&g(e),t=!1,a()}}}function Oe(s){let e,l,t,a="Välj användare",o,n,r="Skapa chatt",i,f,d=R(s[4]),u=[];for(let h=0;h<d.length;h+=1)u[h]=re(se(s,d,h));return{c(){e=E("form"),l=E("select"),t=E("option"),t.textContent=a;for(let h=0;h<u.length;h+=1)u[h].c();o=I(),n=E("button"),n.textContent=r,this.h()},l(h){e=T(h,"FORM",{class:!0});var _=D(e);l=T(_,"SELECT",{});var m=D(l);t=T(m,"OPTION",{"data-svelte-h":!0}),j(t)!=="svelte-1p3n37b"&&(t.textContent=a);for(let p=0;p<u.length;p+=1)u[p].l(m);m.forEach(g),o=O(_),n=T(_,"BUTTON",{class:!0,"data-svelte-h":!0}),j(n)!=="svelte-fnk4wi"&&(n.textContent=r),_.forEach(g),this.h()},h(){t.disabled=!0,t.selected=!0,t.__value="null",G(t,t.__value),s[5]===void 0&&he(()=>s[11].call(l)),y(n,"class","svelte-vs1kai"),y(e,"class","svelte-vs1kai")},m(h,_){M(h,e,_),w(e,l),w(l,t);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(l,null);$(l,s[5],!0),w(e,o),w(e,n),i||(f=L(l,"change",s[11]),i=!0)},p(h,_){if(_&16){d=R(h[4]);let m;for(m=0;m<d.length;m+=1){const p=se(h,d,m);u[m]?u[m].p(p,_):(u[m]=re(p),u[m].c(),u[m].m(l,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=d.length}_&48&&$(l,h[5])},d(h){h&&g(e),Z(u,h),i=!1,f()}}}function re(s){let e,l=s[19].data.username+"",t,a,o;return{c(){e=E("option"),t=V(l),a=I(),this.h()},l(n){e=T(n,"OPTION",{});var r=D(e);t=q(r,l),a=O(r),r.forEach(g),this.h()},h(){e.__value=o=s[19].uid,G(e,e.__value)},m(n,r){M(n,e,r),w(e,t),w(e,a)},p(n,r){r&16&&l!==(l=n[19].data.username+"")&&F(t,l),r&16&&o!==(o=n[19].uid)&&(e.__value=o,G(e,e.__value))},d(n){n&&g(e)}}}function Pe(s){let e,l="Välj en chatt från listan till vänster";return{c(){e=E("p"),e.textContent=l},l(t){e=T(t,"P",{"data-svelte-h":!0}),j(e)!=="svelte-7akmd2"&&(e.textContent=l)},m(t,a){M(t,e,a)},p:S,i:S,o:S,d(t){t&&g(e)}}}function Ae(s){let e,l,t=s[1].data.name+"",a,o,n,r,i,f,d,u,h="Skicka",_,m,p,c=s[3]&&ie(s);return{c(){e=E("div"),l=E("h1"),a=V(t),o=I(),n=E("div"),c&&c.c(),r=I(),i=E("form"),f=E("input"),d=I(),u=E("button"),u.textContent=h,this.h()},l(C){e=T(C,"DIV",{id:!0,class:!0});var k=D(e);l=T(k,"H1",{});var b=D(l);a=q(b,t),b.forEach(g),k.forEach(g),o=O(C),n=T(C,"DIV",{id:!0,class:!0});var N=D(n);c&&c.l(N),N.forEach(g),r=O(C),i=T(C,"FORM",{class:!0});var v=D(i);f=T(v,"INPUT",{type:!0,id:!0,autocomplete:!0,class:!0}),d=O(v),u=T(v,"BUTTON",{class:!0,"data-svelte-h":!0}),j(u)!=="svelte-pnp7e8"&&(u.textContent=h),v.forEach(g),this.h()},h(){y(e,"id","title"),y(e,"class","svelte-vs1kai"),y(n,"id","messages"),y(n,"class","svelte-vs1kai"),y(f,"type","text"),y(f,"id","message"),y(f,"autocomplete","off"),y(f,"class","svelte-vs1kai"),y(u,"class","svelte-vs1kai"),y(i,"class","svelte-vs1kai")},m(C,k){M(C,e,k),w(e,l),w(l,a),M(C,o,k),M(C,n,k),c&&c.m(n,null),M(C,r,k),M(C,i,k),w(i,f),G(f,s[2]),w(i,d),w(i,u),_=!0,m||(p=[L(f,"input",s[13]),L(i,"submit",function(){_e(s[7](s[2]))&&s[7](s[2]).apply(this,arguments)})],m=!0)},p(C,k){s=C,(!_||k&2)&&t!==(t=s[1].data.name+"")&&F(a,t),s[3]?c?(c.p(s,k),k&8&&P(c,1)):(c=ie(s),c.c(),P(c,1),c.m(n,null)):c&&(W(),B(c,1,1,()=>{c=null}),Q()),k&4&&f.value!==s[2]&&G(f,s[2])},i(C){_||(P(c),_=!0)},o(C){B(c),_=!1},d(C){C&&(g(e),g(o),g(n),g(r),g(i)),c&&c.d(),m=!1,me(p)}}}function ie(s){let e=s[3],l,t,a=ue(s);return{c(){a.c(),l=H()},l(o){a.l(o),l=H()},m(o,n){a.m(o,n),M(o,l,n),t=!0},p(o,n){n&8&&Y(e,e=o[3])?(W(),B(a,1,1,S),Q(),a=ue(o),a.c(),P(a,1),a.m(l.parentNode,l)):a.p(o,n)},i(o){t||(P(a),t=!0)},o(o){B(a),t=!1},d(o){o&&g(l),a.d(o)}}}function ce(s){let e,l;return e=new Ne({props:{message:s[16],user:s[1].cachedMembers[s[16].data.sender.id],currentUid:s[0].uid}}),{c(){ve(e.$$.fragment)},l(t){ge(e.$$.fragment,t)},m(t,a){ke(e,t,a),l=!0},p(t,a){const o={};a&8&&(o.message=t[16]),a&10&&(o.user=t[1].cachedMembers[t[16].data.sender.id]),a&1&&(o.currentUid=t[0].uid),e.$set(o)},i(t){l||(P(e.$$.fragment,t),l=!0)},o(t){B(e.$$.fragment,t),l=!1},d(t){be(e,t)}}}function ue(s){let e,l,t=R(s[3]),a=[];for(let n=0;n<t.length;n+=1)a[n]=ce(ae(s,t,n));const o=n=>B(a[n],1,1,()=>{a[n]=null});return{c(){for(let n=0;n<a.length;n+=1)a[n].c();e=H()},l(n){for(let r=0;r<a.length;r+=1)a[r].l(n);e=H()},m(n,r){for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,r);M(n,e,r),l=!0},p(n,r){if(r&11){t=R(n[3]);let i;for(i=0;i<t.length;i+=1){const f=ae(n,t,i);a[i]?(a[i].p(f,r),P(a[i],1)):(a[i]=ce(f),a[i].c(),P(a[i],1),a[i].m(e.parentNode,e))}for(W(),i=t.length;i<a.length;i+=1)o(i);Q()}},i(n){if(!l){for(let r=0;r<t.length;r+=1)P(a[r]);l=!0}},o(n){a=a.filter(Boolean);for(let r=0;r<a.length;r+=1)B(a[r]);l=!1},d(n){n&&g(e),Z(a,n)}}}function Be(s){var N;let e,l,t,a="Chattar",o,n,r,i,f,d,u,h,_={ctx:s,current:null,token:null,hasCatch:!1,pending:Se,then:De,catch:Me,value:22};x(n=s[6]((N=s[0])==null?void 0:N.data.chats),_);function m(v,U){return v[4]?Oe:Ie}let p=m(s),c=p(s);const C=[Ae,Pe],k=[];function b(v,U){return v[1]?0:1}return d=b(s),u=k[d]=C[d](s),{c(){e=E("main"),l=E("aside"),t=E("h2"),t.textContent=a,o=I(),_.block.c(),r=I(),c.c(),i=I(),f=E("div"),u.c(),this.h()},l(v){e=T(v,"MAIN",{class:!0});var U=D(e);l=T(U,"ASIDE",{class:!0});var A=D(l);t=T(A,"H2",{"data-svelte-h":!0}),j(t)!=="svelte-l4ls8d"&&(t.textContent=a),o=O(A),_.block.l(A),r=O(A),c.l(A),A.forEach(g),i=O(U),f=T(U,"DIV",{id:!0,class:!0});var z=D(f);u.l(z),z.forEach(g),U.forEach(g),this.h()},h(){y(l,"class","svelte-vs1kai"),y(f,"id","chat"),y(f,"class","svelte-vs1kai"),y(e,"class","svelte-vs1kai")},m(v,U){M(v,e,U),w(e,l),w(l,t),w(l,o),_.block.m(l,_.anchor=null),_.mount=()=>l,_.anchor=r,w(l,r),c.m(l,null),w(e,i),w(e,f),k[d].m(f,null),h=!0},p(v,[U]){var z;s=v,_.ctx=s,U&1&&n!==(n=s[6]((z=s[0])==null?void 0:z.data.chats))&&x(n,_)||Ce(_,s,U),p===(p=m(s))&&c?c.p(s,U):(c.d(1),c=p(s),c&&(c.c(),c.m(l,null)));let A=d;d=b(s),d===A?k[d].p(s,U):(W(),B(k[A],1,1,()=>{k[A]=null}),Q(),u=k[d],u?u.p(s,U):(u=k[d]=C[d](s),u.c()),P(u,1),u.m(f,null))},i(v){h||(P(u),h=!0)},o(v){B(u),h=!1},d(v){v&&g(e),_.block.d(),_.token=null,_=null,c.d(),k[d].d()}}}function je(s,e,l){let t;Te.subscribe(b=>{l(0,t=b)});async function a(b){return await Promise.all((b||[]).map(async v=>{const U=await ee(te(K,"chats",v));if(U.data())return{uid:U.id,data:U.data()};throw new Error("Kunde inte hitta chatt")}))}async function o(b){const N=X(K,"chats",b,"messages");l(3,h=[]),(await le(N)).forEach(v=>{l(3,h=[...h,{uid:v.id,data:v.data()}])}),h.sort((v,U)=>v.data.time.seconds-U.data.time.seconds)}async function n(b){const N=await ee(b);l(1,d.cachedMembers[b.id]={uid:b.id,data:await N.data()},d)}async function r(b){l(2,u="");const N=X(K,"chats",d.uid,"messages"),v={content:b,sender:te(K,"users",t.uid),time:we.now()},U=await Ee(N,v);l(3,h=[...h,{uid:U.id,data:v}])}async function i(){if(d){l(1,d.cachedMembers={},d);for(let b of d.data.members)await n(b);o(d.uid)}}async function f(){let b=[];const N=X(K,"users");return(await le(N)).forEach(v=>{v.id!=t.uid&&b.push({uid:v.id,data:v.data()})}),b}let d=null,u="",h=[],_=null,m;const p=async b=>{l(1,d=b),await i()};function c(){m=pe(this),l(5,m),l(4,_)}const C=async()=>l(4,_=await f());function k(){u=this.value,l(2,u)}return[t,d,u,h,_,m,a,r,i,f,p,c,C,k]}class Ke extends fe{constructor(e){super(),de(this,e,je,Be,Y,{})}}export{Ke as component};
